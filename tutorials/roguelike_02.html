<html>
    <head>
        <link rel='stylesheet' href='../main.css'>
        <link rel='stylesheet' href='../tutorials.css'>
        <link rel='stylesheet' href='../highlight.css'>
        <link rel='icon' href='../img/dflogo.svg' type="image/x-icon">
        <script src="popup_close.js"></script>
    <title>Hugues Ross - Tutorials</title>
    </head>
    <body>
    <div class="main-bar">
        <a id="main-name" href="../index.html"><img src="../img/dflogo.svg"/>Hugues Ross</a>
        <div class="main-nav">
            <a class="nav-entry" href="../about.html"><span class="nav-underline">About Me</span></a>
            <a class="nav-entry" href="http://www.huguesross.net"><span class="nav-underline">Blog</span></a>
            <a class="nav-entry" id="selected" href="../tutorials.html"><span class="nav-underline">Tutorials</span></a>
            <a class="nav-entry" href="../software.html"><span class="nav-underline">Software</span></a>
            <a class="nav-entry" href="../games.html"><span class="nav-underline">Games</span></a>
        </div>
    </div>
    <!-- Main Area -->
    <div class='page-content tutorial'>
        <div class="tnav-flex">
            <a href="roguelike_01.html" rel="prev">Previous Part</a>
            <!-- <a href="roguelike_01_5.html" rel="prev">Previous Part</a> -->
            <a href="roguelike_index.html">Index</a>
            <a href="#" rel="next" class="tnav-spacer">Next Part</a>
            <!-- <a href="roguelike_03.html" rel="next">Next Part</a> -->
        </div>

        <h1>Let's Make a Roguelike - 2 - Curses 101</h1>
        <h2>Getting Started</h2>
        <p>
            In the previous part, we looked at the tools and libraries that we'll be using in this series.
            Now that that's done, the next step is to take a closer look at the curses API.
            I think learning by doing is a pretty good policy, so we're going to start off by writing some code!
        </p>

        <h3>'Hello, World!'</h3>
        <p>
            I consider myself a bit of a traditionalist, which you've probably guessed given that I'm using C for personal projects in this day and age.
            As such, I love good Hello World to start off any new language or library.
            So, let's make that happen.
        </p>
        <p>
            The two most basic functions to know in curses are <b>initscr()</b> and <b>endwin()</b>.
            These two functions initialize and clean up curses, respectively. (Technically they do more than that, but from my experience you'll pretty much only ever use them to begin and end your application)
            You should always call <b>initscr()</b> before any other curses functions, and <b>endwin()</b> when you're done.
            Between these two functions, you can call <b>printw()</b> to print text. <b>printw()</b> takes the same arguments as C's <b>printf()</b>, and is the curses equivalent.
            Using these 3 functions, you can make a simple program that looks a lot like this:
        </p>
<pre class="hl">
<span class="hl lin">    1 </span><span class="hl ppc">#include &lt;curses.h&gt; <span class="hl slc">// Depending on your system, you may need to change this line to include your version of PDCurses</span></span>
<span class="hl lin">    2 </span>
<span class="hl lin">    3 </span><span class="hl kwb">int</span> <span class="hl kwd">main</span><span class="hl opt">() {</span>
<span class="hl lin">    4 </span>    <span class="hl kwd">initscr</span><span class="hl opt">();</span>
<span class="hl lin">    5 </span>    <span class="hl kwd">printw</span><span class="hl opt">(</span><span class="hl str">&quot;Hello, World!&quot;</span><span class="hl opt">);</span>
<span class="hl lin">    6 </span>    <span class="hl kwd">endwin</span><span class="hl opt">();</span>
<span class="hl lin">    7 </span>
<span class="hl lin">    8 </span>    <span class="hl kwa">return</span> <span class="hl num">0</span><span class="hl opt">;</span>
<span class="hl lin">    9 </span><span class="hl opt">}</span>
</pre>
        <p>
            If you try to run this program, you'll notice that it opens and closes immediately.
            We need to make our program pause so that we can see the results of our work, preferably until the user presses a button.
            Thankfully curses makes this easy for us, with the <b>getch()</b> function.
            <b>getch()</b> waits for the user to provide input, and returns it as an int.
            After adding a single <b>getch()</b> after printing out your message, your window should stay open until you press a key.
        </p>
        <p>
            Before we wrap up this little example program, let's prompt the user for input.
            If we simply add a second <b>printw()</b>, the result will end up on the same line as our original message.
            We could add the second line to our original print statement with a \n, but let's do things the proper way.
            Because curses is designed to allow any part of the terminal (or window, in our case) to be drawn to, we can move the cursor elsewhere to draw our second message wherever we want.
            The <b>move()</b> function takes in the line and column as ints, and sets the cursor's position accordingly. (Quick reminder: This means that the y position is passed in <b>first</b>)
            This time, we just want to go a line or two down so we can pass in something like <b>1, 0</b> or <b>2, 0</b> as our arguments.
        </p>
<pre class="hl">
<span class="hl lin">    1 </span><span class="hl ppc">#include &lt;curses.h&gt;</span>
<span class="hl lin">    2 </span>
<span class="hl lin">    3 </span><span class="hl kwb">int</span> <span class="hl kwd">main</span><span class="hl opt">() {</span>
<span class="hl lin">    4 </span>    <span class="hl slc">// Initialize curses</span>
<span class="hl lin">    5 </span>    <span class="hl kwd">initscr</span><span class="hl opt">();</span>
<span class="hl lin">    6 </span>
<span class="hl lin">    7 </span>    <span class="hl kwd">printw</span><span class="hl opt">(</span><span class="hl str">&quot;Hello, World!&quot;</span><span class="hl opt">);</span>
<span class="hl lin">    8 </span>    <span class="hl kwd">move</span><span class="hl opt">(</span><span class="hl num">1</span><span class="hl opt">,</span> <span class="hl num">0</span><span class="hl opt">);</span>
<span class="hl lin">    9 </span>    <span class="hl kwd">printw</span><span class="hl opt">(</span><span class="hl str">&quot;Press any key to continue...&quot;</span><span class="hl opt">);</span>
<span class="hl lin">   10 </span>
<span class="hl lin">   11 </span>    <span class="hl slc">// Pause the program until we press a key</span>
<span class="hl lin">   12 </span>    <span class="hl kwd">getch</span><span class="hl opt">();</span>
<span class="hl lin">   13 </span>
<span class="hl lin">   14 </span>    <span class="hl slc">// Clean up</span>
<span class="hl lin">   15 </span>    <span class="hl kwd">endwin</span><span class="hl opt">();</span>
<span class="hl lin">   16 </span>
<span class="hl lin">   17 </span>    <span class="hl kwa">return</span> <span class="hl num">0</span><span class="hl opt">;</span>
<span class="hl lin">   18 </span><span class="hl opt">}</span>
</pre>
        <p>
            ...And there you have it!
            You've now written your first curses program.
        </p>
        <div class="note">
            <h1>Note - On the subject of prefixes</h1>
            Curses provides some shortcuts to make your life easier by adding prefixes to functions.
            Most output functions support adding an 'mv' to the start of their name, which allows you to specify the position of the output.
            For instance, our "Press any key to continue" up above could be written as 
<pre class="hl">
<span class="hl lin">    9 </span>    <span class="hl kwd">mvprintw</span><span class="hl opt">(</span></span><span class="hl num">1</span><span class="hl opt">,</span> <span class="hl num">0</span><span class="hl opt">,</span> <span class="hl str">&quot;Press any key to continue...&quot;</span><span class="hl opt">);</span>
</pre>
            ...in order to save space.
            <br/>
            The other main prefix is 'w', which allows you to specify which curses window to draw to.
            I'll be covering that in a later chapter, so don't worry about it for now.
            Lastly, you can also use 'mvw' to specify the position and the window at the same time.
        </div>

        <h2>The Example App</h2>
        <p>
            Next, I'll show off some of the other features in curses using a simple example that I've put together.
            This example has a few demos showing off different features in curses.
            You can find the code for this program <a href="https://github.com/Df458/Dark-Lands/archive/6a5427712b86cee68d21d34cb0de17ddd49dd8ec.zip">here</a>, and there's also a Windows executable version <a href="https://mega.nz/#!xtxmEIYS!_CsFjyaNenvBFaDkdk8y0QsAD9JWyCkJP0lpeIzuToE">here</a> for those who don't want to compile it.
            Let's go over the demos and how they work:
        </p>

        <h3>Animation</h3>
        <img class="center-screenshot" src="roguelike_02_01.png" alt=""/>
        <p>
            In my previous attempt at this tutorial series, I incorrectly stated that you couldn't do high-speed motion or animation in curses.
            However, this isn't quite true.
            On most normal terminals, drawing ncurses graphics at a high refresh rate results in an awful flicker, as well as some lag (depending on your system).
            However, PDCurses doesn't seem to have this issue and can handle rapidly-changing output rather well!
        </p>
        <p>
            To demonstrate this in action, I've made a simple spinning animation that's tied to a user-controlled refresh rate (labelled "tick delay" on the interface).
            Curses only offers getch to handle single-character input, but there's a trick that we can use to do that while simultaneously updating the application.
            By calling the <b>nodelay()</b> function, we can make getch not wait for input, instead providing -1 if no buttons were pressed.
        </p>

        <h3>Colors</h3>
        <img class="center-screenshot" src="roguelike_02_02.png" alt=""/>
        <p>
            The colors demo shows you the number of available colors, and draws the defaults.
            As I mentioned in the last part, the SDL version of PDCurses is limited to 16 colors.
            However, the ability to change colors at any time (Not to mention the fact that most roguelikes don't use many colors) makes this limitation less of an obstacle than you might expect.
            I'll be covering color in greater detail at a later point, because the subject is a little too complex to do justice to here.
        </p>
        <p>
            You should also take note of the color pair counter.
            Curses handles colors in pairs (one for the foreground and one for the background), and the version that we're using supports just enough pairs to cover every permutation of our allotted 16 colors.
            The default 16 colors provide light and dark versions of the following 8 "standard" colors: White (with black as the dark variant), Blue, Green, Cyan, Red, Magenta, Yellow, and Gray.
        </p>

        <h3>Styles</h3>
        <img class="center-screenshot" src="roguelike_02_03.png" alt=""/>
        <p>
            For this demo, I took every available curses text attribute and rendered text with it.
            To turn an attribute on/off for drawing, you simply have to use the <b>attron</b>/<b>attroff</b> functions.
            The functions take an enum value as an argument, which represents the particular attribute that you want to use.
            Of the 11 attributes that I tried, the following worked as advertised in this implementation (with their enum values):
        </p>
        <ul>
            <li>Normal [<b>A_NORMAL</b>]</li>
            <li>Standout [<b>A_STANDOUT</b>] - Makes the text stand out in whatever way is deemed appropriate. Here, it highlights the text.</li>
            <li>Underline [<b>A_UNDERLINE</b>] - Does what it says on the tin.</li>
            <li>Reverse [<b>A_REVERSE</b>] - Inverts the colors</li>
            <li>Alternate Charset [<b>A_ALTCHARSET</b>] - Replaces normal text with extended ASCII. This isn't typically used, but I guess it works.</li>
        </ul>
        <p> Of the ones that didn't work out, a couple of them had interesting results:</p>
        <ul>
            <li>Blink [<b>A_BLINK</b>] - Instead of making the text blink, it gave it a gray background. This is odd, but not an issue. If blinking is necessary, we can still do it ourselves via animation.</li>
            <li>Protected [<b>A_PROTECT</b>] - Some research tells me that this supposed to protect text from being deleted by certain functions. I don't know if that works, but I <b>do</b> know that it makes a weird grid pattern on your text for some reason.</li>
        </ul>
        <p>
        Bear in mind that if you're using a different version of PDCurses (or NCurses), your results on this demo (and the color demo) will likely be quite different. This demonstrates why I'm using this particular flavor of curses: <i>This is the only variant that supports all platforms while providing the same exact feature set for each.</i> Some other versions will provide more support, but then you'll have to carefully manage when to use what. For a basic-level tutorial like this one, juggling features across platforms and environments is way out of scope.
        </p>

        <h3>Charmap</h3>
        <img class="center-screenshot" src="roguelike_02_04.png" alt=""/>
        <p>
            The last demo is just a simple character map.
            It doesn't do anything fancy, but it might be useful to use the code to test a custom font.
        </p>

        <h2>Wrapping Up</h2>
        <p>
            I hope you appreciated dipping your toe into curses, while also seeing what's possible with some more advanced features.
            Next time, we'll start our game proper by creating a character and putting them in a level.
            This also means no <i>Next Steps</i> section this time around.
            Take a break!
        </p>

        <div class="tnav-flex">
            <a href="roguelike_01.html">Previous Part</a>
            <!-- <a href="roguelike_01_5.html">Previous Part</a> -->
            <a href="roguelike_index.html">Index</a>
            <a href="#" rel="next" class="tnav-spacer">Next Part</a>
            <!-- <a href="roguelike_03.html" rel="next">Next Part</a> -->
        </div>
    </div>
</body>
</html>
